# æ–‡ä»¶ç¼–ç æ”¯æŒè¯´æ˜

## ğŸ¯ æ”¯æŒçš„ç¼–ç æ ¼å¼

ç³»ç»Ÿç°åœ¨æ”¯æŒä»¥ä¸‹æ–‡ä»¶ç¼–ç æ ¼å¼ï¼š

### 1. UTF ç³»åˆ—
- âœ… **UTF-8** (æ¨è)
- âœ… **UTF-8 with BOM**
- âœ… **UTF-16LE** (Little Endian)
- âœ… **UTF-16BE** (Big Endian)

### 2. ä¸­æ–‡ç¼–ç 
- âœ… **GBK** (å›½æ ‡æ‰©å±•ï¼Œæœ€å¸¸ç”¨)
- âœ… **GB2312** (ç®€ä½“ä¸­æ–‡)
- âœ… **Big5** (ç¹ä½“ä¸­æ–‡)

### 3. å…¶ä»–ç¼–ç 
- âœ… **Latin1** (ISO-8859-1)
- âœ… **ASCII**

---

## ğŸ” è‡ªåŠ¨ç¼–ç æ£€æµ‹

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç¼–ç ï¼Œæ£€æµ‹æµç¨‹ï¼š

### 1. BOM æ ‡è®°æ£€æµ‹
```
UTF-8 BOM:    EF BB BF
UTF-16LE BOM: FF FE
UTF-16BE BOM: FE FF
```

### 2. æ™ºèƒ½è¯„åˆ†æ£€æµ‹

å¦‚æœæ²¡æœ‰ BOM æ ‡è®°ï¼Œç³»ç»Ÿä¼šå°è¯•å¤šç§ç¼–ç å¹¶è¯„åˆ†ï¼š

**è¯„åˆ†æ ‡å‡†**:
- âœ… æ— ä¹±ç å­—ç¬¦: +10 åˆ†
- âœ… ä¸­æ–‡å­—ç¬¦æ¯”ä¾‹: +100 åˆ† Ã— æ¯”ä¾‹
- âœ… è‹±æ–‡å­—ç¬¦æ¯”ä¾‹: +10 åˆ† Ã— æ¯”ä¾‹
- âœ… ä¸­æ–‡æ ‡ç‚¹ç¬¦å·: +50 åˆ† Ã— æ¯”ä¾‹
- âŒ ä¸å¯æ‰“å°å­—ç¬¦è¿‡å¤š: -50 åˆ†

**é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç¼–ç **

---

## ğŸ“ æµ‹è¯•ç¤ºä¾‹

### æµ‹è¯•æ–‡ä»¶: `1.txt`

**æ–‡ä»¶ä¿¡æ¯**:
- ç¼–ç : GBK
- å¤§å°: 78,952 å­—èŠ‚
- å­—ç¬¦æ•°: 40,073 (è§£ç å)
- å†…å®¹: ä¸­æ–‡å°è¯´

**æ£€æµ‹ç»“æœ**:
```
âœ… æˆåŠŸæ£€æµ‹ä¸º GBK ç¼–ç 
âœ… æ— ä¹±ç å­—ç¬¦
âœ… æ­£ç¡®è§£ç ä¸­æ–‡å†…å®¹
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### ä¾èµ–åº“

```json
{
  "iconv-lite": "^0.6.3"
}
```

### æ ¸å¿ƒå‡½æ•°

#### 1. `detectEncoding(buffer: Buffer): string`

è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç¼–ç ï¼š

```typescript
// æ£€æŸ¥ BOM
if (buffer[0] === 0xEF && buffer[1] === 0xBB && buffer[2] === 0xBF) {
  return 'utf8'
}

// å°è¯•å¤šç§ç¼–ç å¹¶è¯„åˆ†
const encodings = ['utf8', 'gbk', 'gb2312', 'utf16le', 'big5']
// ... è¯„åˆ†é€»è¾‘
return bestEncoding
```

#### 2. `processFileContent(buffer, filename, options)`

å¤„ç†æ–‡ä»¶å†…å®¹ï¼š

```typescript
// æ£€æµ‹ç¼–ç 
const encoding = detectEncoding(buffer)

// è§£ç 
if (encoding === 'gbk' || encoding === 'gb2312' || encoding === 'big5') {
  content = iconv.decode(buffer, encoding)
} else {
  content = buffer.toString(encoding)
}
```

---

## ğŸ“Š ç¼–ç å¯¹æ¯”

### GBK vs UTF-8

| ç‰¹æ€§ | GBK | UTF-8 |
|------|-----|-------|
| ä¸­æ–‡å­—ç¬¦å¤§å° | 2 å­—èŠ‚ | 3 å­—èŠ‚ |
| è‹±æ–‡å­—ç¬¦å¤§å° | 1 å­—èŠ‚ | 1 å­—èŠ‚ |
| å…¼å®¹æ€§ | Windows å¸¸ç”¨ | å›½é™…æ ‡å‡† |
| æ¨èåº¦ | â­â­â­ | â­â­â­â­â­ |

**ç¤ºä¾‹**:
```
æ–‡æœ¬: "ä½ å¥½ Hello"

GBK:  4 + 1 + 5 = 10 å­—èŠ‚
UTF-8: 6 + 1 + 5 = 12 å­—èŠ‚
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. æ£€æŸ¥æ–‡ä»¶ç¼–ç 

```bash
# ä½¿ç”¨ file å‘½ä»¤
file -I filename.txt

# ä½¿ç”¨ hexdump æŸ¥çœ‹å‰å‡ ä¸ªå­—èŠ‚
hexdump -C filename.txt | head -5
```

### 2. è½¬æ¢ç¼–ç 

```bash
# GBK è½¬ UTF-8
iconv -f GBK -t UTF-8 input.txt > output.txt

# GB2312 è½¬ UTF-8
iconv -f GB2312 -t UTF-8 input.txt > output.txt
```

### 3. Node.js æµ‹è¯•

```javascript
const fs = require('fs');
const iconv = require('iconv-lite');

// è¯»å–æ–‡ä»¶
const buffer = fs.readFileSync('file.txt');

// å°è¯• GBK è§£ç 
const content = iconv.decode(buffer, 'gbk');

// æ£€æŸ¥ç»“æœ
console.log('æœ‰ä¹±ç :', content.includes('ï¿½'));
console.log('æœ‰ä¸­æ–‡:', /[\u4e00-\u9fff]/.test(content));
console.log('å‰100å­—ç¬¦:', content.slice(0, 100));
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: ä¹±ç 

**ç—‡çŠ¶**: æ–‡ä»¶å†…å®¹æ˜¾ç¤ºä¸ºä¹±ç 

**å¯èƒ½åŸå› **:
1. ç¼–ç æ£€æµ‹é”™è¯¯
2. æ–‡ä»¶æœ¬èº«å·²æŸå

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æ–‡ä»¶ç¼–ç 
file -I filename.txt

# 2. æ‰‹åŠ¨æŒ‡å®šç¼–ç 
# åœ¨ä¸Šä¼ æ—¶æ·»åŠ  encoding å‚æ•°

# 3. è½¬æ¢ä¸º UTF-8
iconv -f GBK -t UTF-8 input.txt > output.txt
```

### é—®é¢˜ 2: éƒ¨åˆ†å­—ç¬¦ä¸¢å¤±

**ç—‡çŠ¶**: æŸäº›ç‰¹æ®Šå­—ç¬¦æ¶ˆå¤±

**å¯èƒ½åŸå› **:
1. ç¼–ç ä¸æ”¯æŒè¯¥å­—ç¬¦
2. å­—ç¬¦è¢«æ¸…ç†å‡½æ•°ç§»é™¤

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥æ¸…ç†æ—¥å¿—
logger.debug('Sanitized content', {
  originalLength,
  cleanedLength,
  removedCount
})
```

### é—®é¢˜ 3: ç¼–ç æ£€æµ‹å¤±è´¥

**ç—‡çŠ¶**: ç³»ç»Ÿæ— æ³•æ­£ç¡®æ£€æµ‹ç¼–ç 

**å¯èƒ½åŸå› **:
1. æ–‡ä»¶å¤ªå°ï¼Œæ ·æœ¬ä¸è¶³
2. æ··åˆç¼–ç 
3. ç‰¹æ®Šæ ¼å¼

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ‰‹åŠ¨æŒ‡å®šç¼–ç 
const options = {
  encoding: 'gbk' // å¼ºåˆ¶ä½¿ç”¨ GBK
}

processFileContent(buffer, filename, options)
```

---

## ğŸ“š å¸¸è§ç¼–ç é—®é¢˜

### 1. Windows è®°äº‹æœ¬ä¿å­˜çš„æ–‡ä»¶

**é»˜è®¤ç¼–ç **: ANSI (GBK on Chinese Windows)

**å»ºè®®**: 
- å¦å­˜ä¸º UTF-8
- æˆ–è®©ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹

### 2. Mac/Linux åˆ›å»ºçš„æ–‡ä»¶

**é»˜è®¤ç¼–ç **: UTF-8

**å»ºè®®**: 
- ä¿æŒ UTF-8
- æœ€ä½³å…¼å®¹æ€§

### 3. ä»ç½‘é¡µå¤åˆ¶çš„æ–‡æœ¬

**å¯èƒ½ç¼–ç **: UTF-8, GBK, Big5

**å»ºè®®**:
- ç²˜è´´åˆ°æ–‡æœ¬ç¼–è¾‘å™¨
- å¦å­˜ä¸º UTF-8

---

## ğŸ¯ æœ€ä½³å®è·µ

### âœ… æ¨è

1. **ä½¿ç”¨ UTF-8 ç¼–ç **
   - å›½é™…æ ‡å‡†
   - æœ€ä½³å…¼å®¹æ€§
   - æ”¯æŒæ‰€æœ‰å­—ç¬¦

2. **ä¿å­˜æ—¶æŒ‡å®šç¼–ç **
   ```
   è®°äº‹æœ¬: æ–‡ä»¶ â†’ å¦å­˜ä¸º â†’ ç¼–ç : UTF-8
   VS Code: å³ä¸‹è§’ â†’ é€‰æ‹©ç¼–ç  â†’ ä¿å­˜ä¸º UTF-8
   ```

3. **æ£€æŸ¥æ–‡ä»¶ç¼–ç **
   ```bash
   file -I filename.txt
   ```

4. **è½¬æ¢æ—§æ–‡ä»¶**
   ```bash
   iconv -f GBK -t UTF-8 old.txt > new.txt
   ```

### âŒ é¿å…

1. **ä¸è¦ä½¿ç”¨ ANSI**
   - ä¸åŒç³»ç»Ÿä¸å…¼å®¹
   - å®¹æ˜“å‡ºç°ä¹±ç 

2. **ä¸è¦æ··åˆç¼–ç **
   - ä¸€ä¸ªæ–‡ä»¶åªç”¨ä¸€ç§ç¼–ç 
   - é¿å…å¤åˆ¶ç²˜è´´æ··åˆ

3. **ä¸è¦å¿½ç•¥ BOM**
   - UTF-8 with BOM æ›´æ˜“è¯†åˆ«
   - ä½†æŸäº›ç³»ç»Ÿä¸æ”¯æŒ

---

## ğŸ“– å‚è€ƒèµ„æ–™

### ç¼–ç æ ‡å‡†
- [UTF-8 - Wikipedia](https://en.wikipedia.org/wiki/UTF-8)
- [GBK - Wikipedia](https://en.wikipedia.org/wiki/GBK_(character_encoding))
- [GB2312 - Wikipedia](https://en.wikipedia.org/wiki/GB_2312)

### å·¥å…·åº“
- [iconv-lite - npm](https://www.npmjs.com/package/iconv-lite)
- [Node.js Buffer](https://nodejs.org/api/buffer.html)

### åœ¨çº¿å·¥å…·
- [ç¼–ç è½¬æ¢å·¥å…·](https://www.convertstring.com/zh_CN/EncodeDecode/HexDecode)
- [æ–‡ä»¶ç¼–ç æ£€æµ‹](https://www.online-toolz.com/tools/text-hex-convertor.php)

---

## ğŸŠ æ€»ç»“

é€šè¿‡æ·»åŠ  `iconv-lite` åº“å’Œæ”¹è¿›ç¼–ç æ£€æµ‹ç®—æ³•ï¼Œç³»ç»Ÿç°åœ¨å¯ä»¥ï¼š

1. âœ… **è‡ªåŠ¨æ£€æµ‹** - æ™ºèƒ½è¯†åˆ« UTF-8, GBK, GB2312, Big5 ç­‰ç¼–ç 
2. âœ… **æ­£ç¡®è§£ç ** - ä½¿ç”¨æ­£ç¡®çš„ç¼–ç è§£ææ–‡ä»¶å†…å®¹
3. âœ… **æ— ä¹±ç ** - é¿å…ç¼–ç é”™è¯¯å¯¼è‡´çš„ä¹±ç é—®é¢˜
4. âœ… **è¯¦ç»†æ—¥å¿—** - è®°å½•ç¼–ç æ£€æµ‹è¿‡ç¨‹ï¼Œä¾¿äºè°ƒè¯•
5. âœ… **å‘åå…¼å®¹** - æ”¯æŒæ—§çš„ GBK ç¼–ç æ–‡ä»¶

**ç°åœ¨å¯ä»¥æ­£ç¡®å¤„ç†å„ç§ç¼–ç çš„ä¸­æ–‡æ–‡æœ¬æ–‡ä»¶äº†ï¼** ğŸš€

---

**æ›´æ–°æ—¶é—´**: 2024-11-11  
**ç»´æŠ¤äººå‘˜**: AI Assistant  
**å½±å“èŒƒå›´**: æ–‡æœ¬å¤„ç†æ¨¡å—
